# === General configuration ===

# Binds <C-s> as the prefix key
unbind C-s
unbind C-b
set -g prefix C-s

# No delay after Esc
set -s escape-time 0

# Increase scrollback buffer size
set -g history-limit 50000

# Adds a blank line below the status bar
set -g "status-format[1]" ""
set -g status 2

# Removes bottom border  from panes
set -g pane-border-status off

# Binds <C-r> to reload tmux config file
unbind r
bind r source-file ~/.tmux.conf

# Configures terminal type and enables 24-bit RGB color support
set -g default-terminal "tmux-256color"
set -ag terminal-overrides ",xterm-256color:RGB"

# Allows mouse support for pane and window management
set -g mouse on

# Renumbers windows automatically after closing and index from 1
set -g renumber-windows on
set -g base-index 1
setw -g pane-base-index 1

# Uses Vim keybindings in copy mode
set-window-option -g mode-keys vi

# Navigates between tmux panes using Vim directional keys
bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Resize panes using Vim directional keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Instantly kill window/pane without the y/n prompt
bind-key & kill-window
bind-key x kill-pane

# Positions the status bar at the top of the window
set-option -g status-position top

# Open new windows and panes in the current pane's directory
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind % split-window -h -c "#{pane_current_path}"

# Move windows left (previous) and right (next)
bind P swap-window -t -1 -d
bind N swap-window -t +1 -d

# === Pane Switching Configuration ===
# Smart pane switching with awareness of Neovim splits using smart-splits.nvim
# See: https://github.com/mrjones2014/smart-splits.nvim

# Smart pane switching with awareness of Neovim splits
bind-key -n C-h if -F "#{@pane-is-vim}" 'send-keys C-h'  'select-pane -L'
bind-key -n C-j if -F "#{@pane-is-vim}" 'send-keys C-j'  'select-pane -D'
bind-key -n C-k if -F "#{@pane-is-vim}" 'send-keys C-k'  'select-pane -U'
bind-key -n C-l if -F "#{@pane-is-vim}" 'send-keys C-l'  'select-pane -R'

# Alternative binding for clearing screen since C-l is used for navigation
bind-key C-l send-keys C-l

# Smart pane resizing with awareness of Neovim splits
bind-key -n M-h if -F "#{@pane-is-vim}" 'send-keys M-h' 'resize-pane -L 3'
bind-key -n M-j if -F "#{@pane-is-vim}" 'send-keys M-j' 'resize-pane -D 3'
bind-key -n M-k if -F "#{@pane-is-vim}" 'send-keys M-k' 'resize-pane -U 3'
bind-key -n M-l if -F "#{@pane-is-vim}" 'send-keys M-l' 'resize-pane -R 3'

# Smart pane swapping with awareness of Neovim splits
bind-key -n M-H if -F "#{@pane-is-vim}" 'send-keys M-H' 'swap-pane -s "{left-of}"'
bind-key -n M-J if -F "#{@pane-is-vim}" 'send-keys M-J' 'swap-pane -s "{down-of}"'
bind-key -n M-K if -F "#{@pane-is-vim}" 'send-keys M-K' 'swap-pane -s "{up-of}"'
bind-key -n M-L if -F "#{@pane-is-vim}" 'send-keys M-L' 'swap-pane -s "{right-of}"'

tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if -F \"#{@pane-is-vim}\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if -F \"#{@pane-is-vim}\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi "C-h" select-pane -L
bind-key -T copy-mode-vi "C-j" select-pane -D
bind-key -T copy-mode-vi "C-k" select-pane -U
bind-key -T copy-mode-vi "C-l" select-pane -R
bind-key -T copy-mode-vi "C-\\" select-pane -l

# === Status bar configuration ===

# Status bar general settings
set -g status-interval 5
set -g status-position top
set -g status-justify left
set -g status-right-length 250

# Transparent background
set -g status-style "bg=default"

# Configure window list
set -g status-left ""
set -g window-status-format "#[fg={{ color0 }},bg=default]#[fg={{ background }},bg={{ color15 }}] #I #[fg={{ color15 }},bg={{ color0 }}] #W #[fg={{ color0 }},bg=default]"
set -g window-status-current-format "#[fg={{ accent }},bg=default]#[fg={{ background }},bg={{ accent }},bold] #I #[fg={{ accent }},bg={{ color0 }}]#[fg={{ foreground }},bg={{ color0 }}] #W #[fg={{ color0 }},bg=default]"
set -g window-status-separator " "
set -g window-status-activity-style "fg={{ background }},bg={{ color11 }},bold"
set -g window-status-bell-style "fg={{ background }},bg={{ color1 }},bold"

# Configure directory, session and, date/time
set -g status-right "#[fg={{ background }},bg={{ background }}]#[fg={{ foreground }},bg={{ background }}]  #[fg={{ foreground }},bg={{ background }}] #{b:pane_current_path} #[fg={{ color0 }},bg={{ background }}]#[fg={{ accent }},bg={{ color0 }}]  #[fg={{ accent }},bg={{ color0 }}] #S #[fg={{ accent }},bg={{ color0 }}]#[fg={{ background }},bg={{ accent }}] 󱑒 #[fg={{ background }},bg={{ accent }}] %a %b %d - %H:%M "

# Pane borders
set -g pane-border-style "fg={{ color0 }}"
set -g pane-active-border-style "fg={{ accent }}"

# Message styling
set -g message-style "fg={{ foreground }},bg={{ color0 }}"
set -g message-command-style "fg={{ foreground }},bg={{ color0 }}"

# Mode styling (copy mode, etc.)
set -g mode-style "fg={{ foreground }},bg={{ color0 }}"
